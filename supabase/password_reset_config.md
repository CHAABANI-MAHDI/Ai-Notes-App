-- ===================================================================
-- PASSWORD RESET & FORGOT PASSWORD CONFIGURATION
-- ===================================================================
-- This is a configuration guide for Supabase Auth password recovery.
-- No SQL execution needed - use the Supabase Dashboard for these settings.
-- ===================================================================

-- ===================================================================
-- SUPABASE DASHBOARD SETUP (REQUIRED)
-- ===================================================================
-- 1. Go to Supabase Dashboard → Authentication → Email Templates
-- 2. Find "Reset Password Email" template
-- 3. IMPORTANT: Make sure the reset link redirects correctly
-- The link should point to: {{ .ConfirmationURL }}
-- Or customize to: https://yourapp.com/#/auth/reset-password?token=...

-- ===================================================================
-- EMAIL TEMPLATE CUSTOMIZATION (RECOMMENDED)
-- ===================================================================
-- Edit the Reset Password email template to match your app branding:

/\*
Default Supabase Reset Password Email Template:

<h2>Reset Password</h2>
<p>Follow this link to reset your password:</p>
<p><a href="{{ .ConfirmationURL }}">Reset Password</a></p>
<p>If you didn't request this, please ignore this email.</p>

Better Custom Template:

<div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;">
  <h2 style="color: #1e1b4b; margin-bottom: 16px;">Reset Your Password</h2>
  <p style="color: #4b5563; margin-bottom: 24px;">
    We received a request to reset your password. Click the button below to set a new password:
  </p>
  <a href="{{ .ConfirmationURL }}" 
     style="display: inline-block; background: linear-gradient(135deg, #6366f1, #7c3aed); 
            color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; 
            font-weight: bold; margin-bottom: 24px;">
    Reset Password
  </a>
  <p style="color: #4b5563; margin-bottom: 8px;">
    Or copy this link if the button doesn't work:
  </p>
  <p style="color: #6b7280; word-break: break-all;">
    {{ .ConfirmationURL }}
  </p>
  <hr style="border: none; border-top: 1px solid #e5e7eb; margin: 24px 0;">
  <p style="color: #9ca3af; font-size: 13px;">
    If you didn't request this email, you can safely ignore it. 
    The link expires in 24 hours.
  </p>
</div>
*/

-- ===================================================================
-- JAVASCRIPT/TYPESCRIPT IMPLEMENTATION
-- ===================================================================
-- Already implemented in your app:

/\*
// In pages/auth/SignIn.tsx - Forgot Password Handler
const { error } = await supabase.auth.resetPasswordForEmail(forgotEmail, {
redirectTo: `${window.location.origin}/#${RoutePath.RESET_PASSWORD}`,
});

// In pages/auth/ResetPassword.tsx - Password Update Handler
const { error } = await supabase.auth.updateUser({ password });
\*/

-- ===================================================================
-- SUPABASE CLI AUTHENTICATION SETTINGS
-- ===================================================================
-- Configure email settings in supabase/config.toml:

/\*
[auth]

# Email provider configuration

enable_signup = true
email_max_frequency = "3600s" # 1 hour between emails
smtp_max_frequency = "3600s"

# Password recovery settings

password_min_length = 6
disable_signup = false

# Email templates (auto-generated by Supabase)

reset_email_for_signup = true
confirm_email_change = true
\*/

-- ===================================================================
-- EMAIL CONFIGURATION CHECKLIST
-- ===================================================================
-- [ ] Go to Authentication → Settings → Email
-- [ ] Verify "Enable Email Provider" is ON
-- [ ] Check SMTP settings (use Supabase's email or custom SMTP)
-- [ ] Set custom sender email if needed (e.g., noreply@yourapp.com)
-- [ ] Test by sending a password reset email from your app
-- [ ] Verify email arrives in a few seconds
-- [ ] Click the reset link and test the reset flow

-- ===================================================================
-- MANUAL PASSWORD RESET (SQL)
-- ===================================================================
-- If you need to reset a user's password from the database:

-- Method 1: Use the Supabase Dashboard
-- 1. Go to Authentication → Users
-- 2. Click on the user
-- 3. Click "Reset password" (sends email)

-- Method 2: Use Supabase CLI
-- supabase auth users reset-password user@example.com

-- Method 3: Use SQL (advanced - requires admin access)
-- This is not recommended as passwords should be managed by Auth
-- Supabase Auth handles password hashing and security automatically

-- ===================================================================
-- EMAIL VERIFICATION & CONFIRMATION
-- ===================================================================
-- Additional email-related settings in Supabase Dashboard:

/\*
Authentication → Email Templates:

1. Confirmation Email - Verify email address on signup
2. Invite Email - Invite users to your app
3. Magic Link Email - Passwordless login (optional)
4. Reset Password Email - Allow password recovery (YOUR USE CASE)
5. Email Change Email - Confirm email change
   \*/

-- ===================================================================
-- TESTING THE PASSWORD RESET FLOW
-- ===================================================================
/\*

1. Go to your app's Sign In page
2. Click "Forgot password?"
3. Enter your email address
4. Check your email (usually arrives in 2-5 seconds)
5. Click the reset link
6. You'll be redirected to /auth/reset-password
7. Enter and confirm your new password
8. You'll be redirected to login
9. Sign in with your new password to verify it works
   \*/

-- ===================================================================
-- TROUBLESHOOTING
-- ===================================================================
/\*
PROBLEM: "Not receiving reset emails"
SOLUTION:

- Check your Supabase project has an email provider enabled
- Check spam/junk folder
- Verify email address is correct
- Make sure your Supabase project has email service active

PROBLEM: "Reset link is broken/expired"
SOLUTION:

- Reset links expire after 24 hours
- Make sure the redirectTo URL matches your app's domain
- Check that RoutePath.RESET_PASSWORD is set correctly

PROBLEM: "Can't update password in ResetPassword.tsx"
SOLUTION:

- User must have valid recovery session from email link
- Make sure Supabase auth session is active
- Try again and check browser console for errors

PROBLEM: "Email template not updating"
SOLUTION:

- Changes to email templates take a few minutes to propagate
- Try clearing browser cache
- Go to Authentication → Email Templates and verify changes
  \*/

-- ===================================================================
-- OPTIONAL: ADD MAGIC LINK LOGIN (Passwordless Auth)
-- ===================================================================
/\*
Instead of password reset, you can use Magic Links for passwordless login:

const { error } = await supabase.auth.signInWithOtp({
email: userEmail,
options: {
emailRedirectTo: `${window.location.origin}/#/`,
},
});

User receives email with magic link, clicks it, and is automatically logged in.
No password needed!
\*/

-- ===================================================================
-- SECURITY BEST PRACTICES
-- ===================================================================
-- ✓ Passwords are hashed automatically by Supabase
-- ✓ Reset links expire after 24 hours
-- ✓ Reset emails are sent over HTTPS
-- ✓ Disable autoFill on password fields if needed
-- ✓ Use HTTPS for your entire app
-- ✓ Never log passwords or tokens
-- ✓ Use secure password requirements

-- ===================================================================
-- MORE INFORMATION
-- ===================================================================
-- Supabase Docs: https://supabase.com/docs/guides/auth/passwords
-- Supabase Auth: https://supabase.com/docs/reference/javascript/auth-resetpasswordforemail
-- Email Templates: https://supabase.com/docs/guides/auth/emails
